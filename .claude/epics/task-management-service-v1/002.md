---
name: BDD測試框架設置與配置
status: open
created: 2025-09-13T13:20:32Z
updated: 2025-09-13T13:20:32Z
github: [Will be updated when synced to GitHub]
depends_on: [001]  # 需要基礎專案結構
parallel: false  # 需要依賴專案基礎
conflicts_with: []
---

# Task: BDD測試框架設置與配置

## Description

設置完整的 BDD 測試框架，包含 SpecFlow、xUnit 整合和測試基礎設施。這是 BDD 驅動開發的第二步，建立測試環境讓後續可以先寫測試場景再實作功能。

## Acceptance Criteria
- [ ] 安裝和配置 SpecFlow 套件到 AcceptanceTests 專案
- [ ] 設置 xUnit 作為測試執行器
- [ ] 建立 SpecFlow 配置檔 (specflow.json)
- [ ] 建立測試基礎類別和工具
- [ ] 設置測試資料庫/Memory儲存的測試設定
- [ ] 建立 API 測試用的 WebApplicationFactory
- [ ] 設置模擬 Callback API 的測試伺服器
- [ ] 驗證 BDD 測試可以執行並產生報告

## Technical Details

### 核心套件安裝
```xml
<!-- TaskManagement.AcceptanceTests.csproj -->
<PackageReference Include="SpecFlow" Version="3.9.74" />
<PackageReference Include="SpecFlow.xUnit" Version="3.9.74" />
<PackageReference Include="SpecFlow.Tools.MsBuild.Generation" Version="3.9.74" />
<PackageReference Include="Microsoft.AspNetCore.Mvc.Testing" Version="9.0.0" />
<PackageReference Include="WireMock.Net" Version="1.5.42" />
```

### 測試基礎設施
- **TestWebApplicationFactory**: 用於 API 整合測試
- **MockCallbackServer**: WireMock 模擬外部 Callback API
- **TestDataBuilder**: 建立測試資料的 Builder Pattern
- **StepDefinitionBase**: 共用的步驟定義基礎類別

### SpecFlow 配置
```json
{
  "language": {
    "feature": "zh-TW",
    "tool": "zh-TW"
  },
  "bindingCulture": {
    "name": "zh-TW"
  },
  "runtime": {
    "dependencies": [
      "TaskManagement.Api"
    ]
  }
}
```

## Dependencies
- [ ] T001 - 專案架構建置完成
- [ ] 網路連線用於套件下載

## Effort Estimate
- Size: M
- Hours: 8-10 小時
- Parallel: false (需要基礎專案)

## Definition of Done
- [ ] 可以執行 `dotnet test` 並看到 SpecFlow 測試框架運作
- [ ] 測試專案可以啟動 API 應用程式進行整合測試
- [ ] 模擬 Callback 伺服器可以正常回應
- [ ] 建立範例 .feature 檔案驗證 Gherkin 語法正確
- [ ] CI/CD 流程可以執行 BDD 測試